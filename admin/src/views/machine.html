<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie9"><![endif]-->

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <meta charset="UTF-8">

    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="../../public/stylesheets/plugin/element.min.css">
    <script src="../../public/javascripts/plugin/vue.js"></script>
    <script src="../../public/javascripts/plugin/element.min.js"></script>

    <title></title>
</head>


<body class="_scrollbar">
    <div id="c-container-list" style="height: 100%;" data-uri="sys_machine_instance_list" v-loading.fullscreen.lock="loading">
        <el-container>
            <el-main>
                <el-main>
                    <el-form>
                        <div style="margin-bottom:10px;">
                            <el-button @click="UpdateTableAndVisible = true; formData = {}; search({url: 'sys_machine_list'})" type="primary">新增设备<i
                                    class="el-icon-plus el-icon--right"></i></el-button>
                            <el-button @click="detailTableAndVisible = true; formData = {}" type="primary">导入设备</el-button>
                        </div>
                    </el-form>
                    <el-form>
                        <el-input placeholder="请输入内容" v-model="listSearch._value_" class="_searchVal">
                            <el-select v-model="listSearch._name_" class="_searchVal_select" slot="prepend"
                                placeholder="请选择" :change="listSearch._name_ = 'machineSn'">
                                <el-option label="设备SN号" value="machineSn"></el-option>
                            </el-select>
                        </el-input>

                        <div class="_search_centent" v-show="more">
                            <el-button>审核状态</el-button>
                            <el-select v-model="listSearch.auditStatus" slot="prepend" placeholder="请选择">
                                <el-option label="不限" value=""></el-option>
                                <el-option label="未审核" value="0"></el-option>
                                <el-option label="已通过" value="1"></el-option>
                                <el-option label="未通过" value="2"></el-option>
                            </el-select>
                        </div>

                        <div class="_search_centent" v-show="more">
                            <el-button>激活状态</el-button>
                            <el-select v-model="listSearch.status" slot="prepend" placeholder="请选择">
                                <el-option label="不限" value=""></el-option>
                                <el-option label="未激活" value="0"></el-option>
                                <el-option label="申请中" value="1"></el-option>
                                <el-option label="已激活" value="2"></el-option>
                            </el-select>
                        </div>

                        <div class="more_search el-icon-circle-plus-outline" v-show="!more" @click="more = !more"> 更多搜索条件
                        </div>
                        <div class="more_search el-icon-remove-outline" v-show="more" @click="more = !more"> 收起 </div>
    
                        <el-button icon="el-icon-search" class="_search_btn" @click="list(listSearch)">搜索
                        </el-button>
                    </el-form>
                    <template>
                        <el-table :data="tableData" stripe style="width: 100%" border>
                            <el-table-column prop="machineSn" label="设备SN号"></el-table-column>
                            <!-- <el-table-column prop="machineInstanceId" label="secretID"></el-table-column> -->
                            <el-table-column prop="machineName" label="设备名称"></el-table-column>
                            <el-table-column prop="machineType" label="设备类型"></el-table-column>
                            <el-table-column prop="orderNum" label="出库单号">
                                <template slot-scope="scope">
                                    {{ scope.row.orderNum == -1 ? '无' : scope.row.orderNum }}
                                </template>
                            </el-table-column>
                            <el-table-column prop="coding" label="物料编号">
                                <template slot-scope="scope">
                                    {{ scope.row.coding == -1 ? '无' : scope.row.coding }}
                                </template>
                            </el-table-column>
                            <!-- <el-table-column prop="maintainStatus" label="质保状态">
                                <template slot-scope="scope">
                                    {{ scope.row.maintainStatus == 1 ? '有效' : '失效' }}
                                </template>
                            </el-table-column> -->
                            <el-table-column prop="auditStatus" label="审核状态">
                                <template slot-scope="scope">
                                    <div :class="scope.row.auditStatus == 2 ? 'red' : scope.row.auditStatus == 1 ? 'green': 'ccc'">
                                        {{ scope.row.auditStatus == 2 ? '未通过' :  scope.row.auditStatus == 1 ? '已通过': '未审核' }}
                                    </div>
                                </template>
                            </el-table-column>

                            <el-table-column prop="status" label="数据状态">
                                <template slot-scope="scope">
                                    <div :class="scope.row.status == 1 ? 'blue' : scope.row.status == 2 ? 'green': 'ccc'">
                                        {{ scope.row.status == 2 ? '已激活' :  scope.row.status == 1 ? '激活申请中': '未激活' }}
                                    </div>
                                </template>
                            </el-table-column>
                            <!-- <el-table-column prop="machinePic" label="图片">
                            <template slot-scope="scope">
                                <el-popover trigger="hover" placement="top">
                                    <el-image :src="scope.row.machinePic == -1 ? scope.row.machinePic = errorImage : scope.row.machinePic"
                                        :preview-src-list="scope.row.machinePic  == -1 ? scope.row.machinePic = errorImage : scope.row.machinePic" style="text-align: center;">
                                    </el-image>
                                    <div slot="reference" class="name-wrapper">
                                        <el-image :src="scope.row.machinePic == -1 ? scope.row.machinePic = errorImage : scope.row.machinePic"
                                            :preview-src-list="scope.row.machinePic == -1 ? scope.row.machinePic = errorImage : scope.row.machinePic" lazy></el-image>
                                    </div>
                                </el-popover>
                            </template>
                        </el-table-column> -->


                            <el-table-column fixed="right" label="操作">
                                <template slot-scope="scope">
                                    <el-button type="text" size="small" @click="machineDest(scope.row.machineInstanceId)">
                                        详情
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </template>

                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange"
                        :current-page="currentPage" :page-sizes="[10, 20, 30, 40]" :page-size="pageSize"
                        layout="total, sizes, prev, pager, next, jumper" :total="total">
                    </el-pagination>


                    <el-dialog title="新增设备" :visible.sync="UpdateTableAndVisible">
                        <el-form :model="formData" id="machine" label-width="180px">
                            <el-form-item label="设备SN码：">
                                <el-input v-model="formData.machineSn"></el-input>
                            </el-form-item>
                            <el-form-item label="物料编号：">
                                <el-select width="100%"
                                    v-model="formData.machineId"
                                    filterable
                                    remote
                                    reserve-keyword
                                    placeholder="输入【物料编号】自动查询，支持模糊查询"
                                    :remote-method="remoteMethod"
                                    :loading="loading">
                                    <el-option
                                    v-for="item in options"
                                    :key="item.value"
                                    :label="item.label"
                                    :value="item.value">
                                    </el-option>
                                </el-select>
                                <div>输入【物料编号】进行查询出结果后，请点击选择相应的【物料编号】</div>
                            </el-form-item>
                            <!-- <el-form-item label="区域地址：">
                                <el-select width="100%"
                                    v-model="formData.addressId"
                                    filterable
                                    remote
                                    reserve-keyword
                                    :remote-method="remoteMethods"
                                    placeholder="输入【区域地址】自动查询，支持模糊查询"
                                    :loading="loading">
                                    <el-option
                                    v-for="item in option"
                                    :key="item.value"
                                    :label="item.label"
                                    :value="item.value">
                                    </el-option>
                                </el-select>
                                <div>输入【区域地址】进行查询出结果后，请点击选择相应的【区域地址】</div>
                            </el-form-item> -->
                            <el-form-item label="出货单号（选填）：">
                                <el-input v-model="formData.orderNum"></el-input>
                            </el-form-item>
                            <el-form-item label="出库日期（选填）：">
                                <el-date-picker v-model="formData.exWarehouseTime" start-placeholder="开始日期">
                                </el-date-picker>
                            </el-form-item>

                            <div class="btn-center" style="text-align: center; margin: 20px;">
                                <el-button type="primary" @click="machine(formData)">提交
                                </el-button>
                            </div>
                        </el-form>
                    </el-dialog>

                    <el-dialog title="导入设备" :visible.sync="detailTableAndVisible">
                        <el-form>
                            <el-form-item label=".CSV文件">
                                <div style="font-size: 10px; color: #409EFF;cursor: pointer;" @click="hrefDown(false)">(模板下载)</div>
                                <template>
                                    <el-upload
                                        :limit="num"
                                        class="upload-demo"
                                        :file-list="fileList"
                                        drag
                                        :action="fileUpdataExc"
                                        :headers="fileUpdataExcData"
                                        :on-success="ExecSceneSuccess"
                                        :on-exceed="exeLength"
                                        multiple>
                                        <i class="el-icon-upload"></i>
                                        <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em>，系统会自动处理数据</div>
                                        </el-upload>
                                </template>
                            </el-form-item>
                            <div class="btn-center" style="text-align: center; margin: 20px;">
                                <el-button type="primary" @click="detailTableAndVisible = false;">关闭
                                </el-button>
                            </div>
                        </el-form>
                    </el-dialog>

                    <el-dialog title="异常数据" :visible.sync="errorExe">
                        <template>
                            <a href="###" id="ahrefDownload">查看失败数据日志</a>
                            <div class="btn-center" style="text-align: center; margin: 20px;">
                                <el-button type="primary" @click="errorExe = false;">关闭
                                </el-button>
                            </div>
                        </template>
                    </el-dialog>

                    <el-dialog title="设备详情" :visible.sync="SearchTableAndVisible" width="50%">
                        <div style="height: 600px;overflow: auto;">
                            <template>
                                <div style="text-align:right;" id="adopt" v-show="adoptModule">
                                    审核是否通过？
                                    <el-button type="primary" size="small" @click="adopt(SearchTableFormData, false)">
                                        通过
                                    </el-button>
                                    <el-button style="background: #c7c7c7;border-color: #c7c7c7;" type="primary"
                                        size="small" @click="adopt(SearchTableFormData, true)">
                                        不通过
                                    </el-button>
                                </div>
                                <!-- <div style="text-align:right;color: red;" id="adopt-error" v-show="adoptModule">
                                    审核不通过！
                                </div> -->
                            </template>
                            <el-form :data="SearchTableFormData" label-width="140px">
                                <el-form-item label="出库单号：" prop="orderNum">
                                    <el-input v-model="SearchTableFormData.orderNum"></el-input>
                                </el-form-item>
                                <el-form-item label="出库日期：" prop="exWarehouseTime">
                                    <el-date-picker v-model="SearchTableFormData.exWarehouseTime" start-placeholder="开始日期">
                                    </el-date-picker>
                                </el-form-item>
                                <el-form-item>
                                    <div style="font-size: 10px;">审核状态：当前选中状态为<span style="color: red;font-size:14px;">{{ SearchTableFormData.auditStatus == 1 ? '【已通过】' : SearchTableFormData.auditStatus == 2 ? '【未通过】' : '【未审核】' }}</span>，此参数若与原先对比发生变化就会修改机器实例的审核相关信息</div>
                                </el-form-item>
                                <el-form-item label="审核状态：" prop="auditStatus">
                                    <el-radio-group v-model="SearchTableFormData.auditStatus">
                                        <el-radio :label="1">审核通过</el-radio>
                                        <el-radio :label="2">审核不通过</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="机器Sn码：" prop="machineSn">
                                    <el-input v-model="SearchTableFormData.machineSn"></el-input>
                                </el-form-item>
                                <el-form-item label="设备型号：" prop="machineType">
                                    <el-input v-model="SearchTableFormData.machineType"></el-input>
                                </el-form-item>
                                <el-form-item label="质保状态：" prop="maintainStatus">
                                    <el-radio-group v-model="SearchTableFormData.maintainStatus">
                                        <el-radio :label="1">有效</el-radio>
                                        <el-radio :label="0">失效</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="审核者当时名称：" prop="auditName">
                                    <el-input v-model="SearchTableFormData.auditName"></el-input>
                                </el-form-item>
                                <el-form-item label="审核时间：" prop="auditTime">
                                    <el-input v-model="SearchTableFormData.auditTime"></el-input>
                                </el-form-item>
                                <el-form-item label="门店名称：" prop="clientName">
                                    <el-input v-model="SearchTableFormData.clientName"></el-input>
                                </el-form-item>
                                <el-form-item label="联系电话：" prop="clientPhone">
                                    <el-input v-model="SearchTableFormData.clientPhone"></el-input>
                                </el-form-item>
                                <el-form-item label="客户所在省：" prop="clientProvince">
                                    <el-input v-model="SearchTableFormData.clientProvince"></el-input>
                                </el-form-item>
                                <el-form-item label="客户所在市：" prop="clientCity">
                                    <el-input v-model="SearchTableFormData.clientCity"></el-input>
                                </el-form-item>
                                <el-form-item label="客户所在区：" prop="clientDistrict">
                                    <el-input v-model="SearchTableFormData.clientDistrict"></el-input>
                                </el-form-item>
                                <el-form-item label="客户详细地址：" prop="clientAddress">
                                    <el-input v-model="SearchTableFormData.clientAddress"></el-input>
                                </el-form-item>

                                <el-form-item label="物料编号：" prop="coding">
                                    <el-input v-model="SearchTableFormData.coding"></el-input>
                                </el-form-item>
                                <el-form-item label="机器色系：" prop="colourScheme">
                                    <el-input v-model="SearchTableFormData.colourScheme"></el-input>
                                </el-form-item>
                                <el-form-item label="经销商：" prop="dealer">
                                    <el-input v-model="SearchTableFormData.dealer"></el-input>
                                </el-form-item>
                                
                                <el-form-item label="销售方电话：" prop="dealerPhone">
                                    <el-input v-model="SearchTableFormData.dealerPhone"></el-input>
                                </el-form-item>
                                <el-form-item label="师傅名称：" prop="maintainerName">
                                    <el-input v-model="SearchTableFormData.maintainerName"></el-input>
                                </el-form-item>
                                <el-form-item label="师傅电话：" prop="maintainerPhone">
                                    <el-input v-model="SearchTableFormData.maintainerPhone"></el-input>
                                </el-form-item>


                                <el-form-item label="质保到期时间：" prop="expireTime">
                                    <el-date-picker v-model="SearchTableFormData.expireTime" start-placeholder="开始日期">
                                    </el-date-picker>
                                </el-form-item>
                                <el-form-item label="质保延长到期时间：" prop="extendExpireTime">
                                    <el-date-picker v-model="SearchTableFormData.extendExpireTime" start-placeholder="开始日期">
                                    </el-date-picker>
                                </el-form-item>
                                <el-form-item label="设备名称：" prop="machineName">
                                    <el-input v-model="SearchTableFormData.machineName"></el-input>
                                </el-form-item>
                                <el-form-item label="机器参数：" prop="machineParameter">
                                    <el-input v-model="SearchTableFormData.machineParameter"></el-input>
                                </el-form-item>
                                <!-- <el-form-item label="机器图片：" prop="machinePic">
                                    {{ SearchTableFormData.machinePic }}
                                </el-form-item> -->
                                <el-form-item label="省：" prop="province">
                                    <el-input v-model="SearchTableFormData.province"></el-input>
                                </el-form-item>
                                <el-form-item label="市：" prop="city">
                                    <el-input v-model="SearchTableFormData.city"></el-input>
                                </el-form-item>
                                <el-form-item label="区：" prop="district">
                                    <el-input v-model="SearchTableFormData.district"></el-input>
                                </el-form-item>
                                <el-form-item label="详细地址：" prop="address">
                                    <el-input v-model="SearchTableFormData.address"></el-input>
                                </el-form-item>
                                <div style="height: auto;overflow: hidden;margin-bottom: 13px;text-align: center;">
                                    <el-button type="primary" @click="updateMachine(SearchTableFormData)">提交更新</el-button>
                                </div>
                                <div style="font-size: 10px;text-align: center;color: red;">以下为详细信息预览</div>
                                <div style="width: 100%;height: 1px; background: #c7c7c7;box-shadow: 0 1px 3px rgba(0,0,0);"></div>
                                <el-form-item label="铭牌照片：" prop="SearchTableFormData.nameplatePic">
                                    <el-popover trigger="click" placement="top" width="600">
                                        <el-image :src="SearchTableFormData.nameplatePic" style="text-align: center;"></el-image>
                                        <div slot="reference" class="name-wrapper">
                                            <el-image :src="SearchTableFormData.nameplatePic" lazy></el-image>
                                        </div>
                                    </el-popover>
                                </el-form-item>
                                <el-form-item label="装机照片：" prop="SearchTableFormData.installPic">
                                    <el-popover trigger="click" placement="top">
                                        <el-image :src="SearchTableFormData.installPic" style="text-align: center;"></el-image>
                                        <div slot="reference" class="name-wrapper">
                                            <el-image :src="SearchTableFormData.installPic" lazy></el-image>
                                        </div>
                                    </el-popover>
                                </el-form-item>
                            </el-form>
                        </div>
    </el-dialog>

    </el-main>
    </el-container>
    </div>
</body>

</html>